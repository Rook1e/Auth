module.exports = (function(file){

  var routings = require(file)

  console.log('[:loading:] routings')
  console.log(routings)

  function middleware (req,res,next){
    var verb = req.verb

    if( verb in routings){
      for(var path in routings[verb] ){   
          if(test_path(path,req.url)){
            console.log('[:routing:] '+req.original_url+'->'+routings[verb][path])
            req.original_url = req.url
            req.url = routings[verb][path]
            req.routed = true
            next()
            return
          }
      }
    }

      for(var path in routings['*'] ){
          if(test_path(path,req.url)){
            console.log('[:routing:] *'+req.original_url+'->'+routings[verb][path])
            req.original_url = req.url
            req.url = routings['*'][path] 
            req.routed = true
            next()
            return
          }
      }
  next()
  }
 
  middleware.routings = routings

  return middleware

  
})

module.exports.test = test_path = function (test,value){
   if( /^\/.*\/$/.test(test) ) test = new RegExp(test.slice(1,test.length -1)) 
   t=test
   if(typeof test=='string') return test == value
   return test.test(value)
}
